<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Is Hunter Okay?</title>
  <meta name="description" content="A delightfully dramatic vibe check: Is Hunter okay?" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b13;
      --panel:#0f1021;
      --text:#e9e9ff;
      --muted:#a7a7c7;
      --ok:#2fffd3;
      --meh:#ffd23f;
      --not:#ff4d6d;
      --accent1:#7b2fff;
      --accent2:#00d1ff;
      --grid:#1a1a2e;
      --glow:0 0 24px rgba(123,47,255,.45),0 0 64px rgba(0,209,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 30% -10%, rgba(123,47,255,.35), transparent 60%),
               radial-gradient(1000px 600px at 90% 10%, rgba(0,209,255,.25), transparent 60%), var(--bg);
      color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
      overflow:hidden;
    }
    /* synthwave horizon grid */
    .grid{
      position:fixed; inset:0; pointer-events:none; opacity:.55;
      background:linear-gradient(to top, transparent 0%, rgba(255,255,255,.05) 1px, transparent 2px) 0 0/100% 40px,
                 linear-gradient(to right, transparent 0%, rgba(255,255,255,.05) 1px, transparent 2px) 0 0/40px 100%;
      mask-image: linear-gradient(to top, rgba(0,0,0,0) 0%, rgba(0,0,0,.9) 30%, rgba(0,0,0,1) 55%);
      transform: perspective(600px) rotateX(65deg) translateY(26vh);
    }
    .scanline{ position:fixed; inset:0; pointer-events:none; background: repeating-linear-gradient( to bottom, rgba(255,255,255,.02) 0 2px, transparent 2px 4px ); mix-blend-mode: overlay; }

    .wrap{ width:min(980px, 100%); position:relative; z-index:1; }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px; padding:28px; box-shadow: var(--glow);
      backdrop-filter: blur(6px);
    }
    .title{
      font-family: Orbitron, Inter, sans-serif; letter-spacing:.02em; text-transform:uppercase;
      display:flex; align-items:center; gap:12px; margin:0 0 6px 0;
    }
    .title span.logo { 
      display:inline-grid; place-items:center; width:38px; height:38px; border-radius:10px; 
      background: conic-gradient(from 0deg, var(--accent1), var(--accent2), var(--accent1));
      filter: drop-shadow(0 0 24px rgba(0,209,255,.35));
      color:#0b0b13; font-weight:800;
    }
    .subtitle{ color:var(--muted); margin:0 0 22px 0; font-size:14px }

    .answer{
      font-family: Orbitron, Inter, sans-serif; font-weight:800; font-size: clamp(36px, 7vw, 82px);
      line-height:1; margin: 8px 0 12px 0; text-shadow: 0 0 10px rgba(0,209,255,.25);
    }
    .answer.ok{ color: var(--ok) }
    .answer.meh{ color: var(--meh) }
    .answer.not{ color: var(--not) }

    .msg{ font-size: clamp(16px, 2.2vw, 22px); color: var(--text); opacity:.95; margin: 6px 0 18px 0 }
    .updated{ color:var(--muted); font-size: 12px }

    .chips{ display:flex; flex-wrap:wrap; gap:10px; margin: 18px 0 2px 0 }
    .chip{ border:1px solid rgba(255,255,255,.12); color: var(--muted); padding:8px 10px; border-radius:999px; font-size:13px }

    .grid2{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:14px; margin-top:18px }
    .panel{ background: var(--panel); border:1px solid rgba(255,255,255,.07); border-radius:16px; padding:14px }
    .panel h3{ font-family: Orbitron, Inter, sans-serif; font-size:12px; letter-spacing:.1em; text-transform:uppercase; margin:0 0 8px 0; color:var(--muted) }
    .metric{ font-size:28px; font-weight:800 }
    .trend{ font-size:12px; color:var(--muted) }

    .footer{ display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:14px; color: var(--muted); font-size:12px }
    .btn{ border:1px solid rgba(255,255,255,.14); background: transparent; color: var(--text); border-radius:10px; padding:8px 12px; cursor:pointer }
    .btn:hover{ border-color: rgba(255,255,255,.28) }

    /* Admin panel (hash #admin) */
    #admin{ display:none; margin-top:16px }
    #admin.visible{ display:block }
    textarea{ width:100%; min-height:160px; background:#0a0b16; color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Cascadia Mono", Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px }
    .tip{ font-size:12px; color:var(--muted); margin:6px 0 8px }

    /* accessibility focus */
    :focus-visible{ outline: 2px solid var(--accent2); outline-offset: 2px }

    @media (max-width:420px){
      .title span.logo{ display:none }
    }
  </style>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230f1021'/%3E%3Ctext x='32' y='42' font-size='36' text-anchor='middle' fill='%232fffd3' font-family='Arial'%3EH%3C/text%3E%3C/svg%3E">
</head>
<body>
  <div class="grid" aria-hidden="true"></div>
  <div class="scanline" aria-hidden="true"></div>

  <main class="wrap">
    <section class="card" role="region" aria-label="Hunter status">
      <h1 class="title"><span class="logo">H</span> Is Hunter Okay?</h1>
      <p class="subtitle">A synthwave vibe-check powered by vibes, weather, caffeine, and manual overrides.</p>

      <div id="answer" class="answer meh" aria-live="polite">Calculating vibes…</div>
      <p id="message" class="msg">Hold tight while we ping the vibe satellites.</p>
      <p id="updated" class="updated">Last updated: —</p>

      <div class="chips" id="chips" aria-label="Quick facts"></div>

      <div class="grid2">
        <div class="panel"><h3>Stability Index</h3><div class="metric" id="stability">—</div><div class="trend" id="stabilityNote">Derived from inputs</div></div>
        <div class="panel"><h3>Optimism</h3><div class="metric" id="optimism">—</div><div class="trend" id="optimismNote">Higher is better</div></div>
        <div class="panel"><h3>Chaos</h3><div class="metric" id="chaos">—</div><div class="trend" id="chaosNote">Lower is better</div></div>
        <div class="panel"><h3>Caffeine</h3><div class="metric" id="caffeine">—</div><div class="trend" id="caffNote">☕ cups today (est.)</div></div>
      </div>

      <div class="footer">
        <span>Tip: add <code>#admin</code> to the URL for a quick local edit panel.</span>
        <div style="display:flex; gap:8px">
          <button class="btn" id="reroll">Re-check vibes</button>
          <a class="btn" href="https://ishunterokay.com" aria-label="Home">Permalink</a>
        </div>
      </div>

      <!-- Admin local editor (does not save to server; lets you export a JSON to upload) -->
      <div id="admin">
        <div class="tip">Paste or edit your manual status JSON here. Click “Download status.json” and upload it to your site root (or commit to your repo). The page auto-loads <code>/status.json</code> on refresh.</div>
        <textarea id="adminText" spellcheck="false" aria-label="Manual status JSON"></textarea>
        <div style="display:flex; gap:8px; margin-top:8px">
          <button class="btn" id="applyLocal">Apply locally</button>
          <button class="btn" id="downloadJson">Download status.json</button>
        </div>
      </div>

    </section>
  </main>

  <script>
  // =============================================================
  //  ishunterokay.com — Client logic
  //  - Loads manual overrides from /status.json (static hosting friendly)
  //  - (Optional) blends with signals (weather, spotify) if configured
  //  - Provides local #admin panel to craft/export JSON for static hosts
  //  - Optional AI vibe synthesis via /api/ai-vibe
  // =============================================================

  const els = {
    answer: document.getElementById('answer'),
    message: document.getElementById('message'),
    updated: document.getElementById('updated'),
    chips: document.getElementById('chips'),
    stability: document.getElementById('stability'),
    optimism: document.getElementById('optimism'),
    chaos: document.getElementById('chaos'),
    caffeine: document.getElementById('caffeine'),
    stabilityNote: document.getElementById('stabilityNote'),
    optimismNote: document.getElementById('optimismNote'),
    chaosNote: document.getElementById('chaosNote'),
  };

  const DEFAULT_STATUS = {
    ok: "meh", // one of: true | false | "meh"
    message: "Systems nominal-ish. Hunter is cautiously optimistic.",
    updated_at: new Date().toISOString(),
    mood_color: "#ffd23f",
    metrics: { stability: 62, optimism: 71, chaos: 28, caffeine_cups: 2 },
    chips: ["Weather: clear skies", "Spotify: hyperfocus mode", "Sleep: 6.5h"],
  };

  async function fetchJSON(url){
    try{
      const sep = url.includes('?') ? '&' : '?';
      const res = await fetch(url + `${sep}t=${Date.now()}`, { cache: 'no-store' });
      if(!res.ok) throw new Error(res.status + ' ' + url);
      return await res.json();
    }catch(e){
      return null;
    }
  }`, { cache: 'no-store' });
      if(!res.ok) throw new Error(res.status + ' ' + url);
      return await res.json();
    }catch(e){
      return null;
    }
  }

  function mergeSignals(manual, signals){
    const base = manual || {};
    const s = signals || {};
    return {
      ok: (base.ok ?? s.ok ?? "meh"),
      message: (base.message ?? s.message ?? DEFAULT_STATUS.message),
      updated_at: (base.updated_at ?? s.updated_at ?? new Date().toISOString()),
      mood_color: (base.mood_color ?? s.mood_color ?? DEFAULT_STATUS.mood_color),
      metrics: {
        stability: (base.metrics?.stability ?? s.metrics?.stability ?? DEFAULT_STATUS.metrics.stability),
        optimism: (base.metrics?.optimism ?? s.metrics?.optimism ?? DEFAULT_STATUS.metrics.optimism),
        chaos: (base.metrics?.chaos ?? s.metrics?.chaos ?? DEFAULT_STATUS.metrics.chaos),
        caffeine_cups: (base.metrics?.caffeine_cups ?? s.metrics?.caffeine_cups ?? DEFAULT_STATUS.metrics.caffeine_cups),
      },
      chips: (Array.isArray(base.chips) && base.chips.length ? base.chips : (s.chips ?? DEFAULT_STATUS.chips))
    };
  }

  function classify(ok){
    if(ok === true || ok === 'true' || ok === 'ok' || ok === 'yes') return 'ok';
    if(ok === false || ok === 'false' || ok === 'no' || ok === 'not') return 'not';
    return 'meh';
  }

  function setUI(state){
    const cls = classify(state.ok);
    els.answer.classList.remove('ok','meh','not');
    els.answer.classList.add(cls);
    const label = cls === 'ok' ? 'YES' : cls === 'not' ? 'NO' : 'KIND OF';
    els.answer.textContent = label;

    els.message.textContent = state.message || '';
    els.updated.textContent = 'Last updated: ' + (new Date(state.updated_at)).toLocaleString();

    const m = state.metrics || {};
    els.stability.textContent = (m.stability ?? '—') + (isFinite(m.stability) ? '%' : '');
    els.optimism.textContent = (m.optimism ?? '—') + (isFinite(m.optimism) ? '%' : '');
    els.chaos.textContent = (m.chaos ?? '—') + (isFinite(m.chaos) ? '%' : '');
    els.caffeine.textContent = (m.caffeine_cups ?? '—');

    els.chips.innerHTML = '';
    (state.chips || []).forEach(c => {
      const span = document.createElement('span');
      span.className = 'chip'; span.textContent = c; els.chips.appendChild(span);
    });

    document.documentElement.style.setProperty('--meh', state.mood_color || '#ffd23f');
  }

  async function getSignals(){
    const cfg = await fetchJSON('/config.json');
    const chips = [];
    const metrics = {};

    try{
      if(cfg?.weather?.enabled && typeof cfg.weather.lat === 'number'){
        const { lat, lon } = cfg.weather;
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`;
        const w = await fetchJSON(url);
        if(w?.current){
          const t = Math.round(w.current.temperature_2m);
          chips.push(`Weather: ${t}°`);
          const stab = 70 - Math.max(0, Math.abs(t-68) - 5);
          metrics.stability = Math.max(20, Math.min(95, stab));
        }
      }
    }catch(e){ /* ignore */ }

    try{
      if(cfg?.spotify?.enabled && cfg.spotify.nowPlayingEndpoint){
        const s = await fetchJSON(cfg.spotify.nowPlayingEndpoint);
        if(s?.track){ chips.push(`Spotify: ${s.track} — ${s.artist}`); }
      }
    }catch(e){ /* ignore */ }

    const ok = (metrics.stability ?? 62) > 60 ? 'meh' : 'not';

    return {
      ok,
      mood_color: '#ffd23f',
      updated_at: new Date().toISOString(),
      metrics: {
        stability: metrics.stability ?? 62,
        optimism: 70,
        chaos: 30,
        caffeine_cups: 2,
      },
      chips,
      _cfg: cfg || {}
    };
  }

  async function fetchAI(manual, signals){
    try{
      if(!signals?._cfg?.ai?.enabled) return null;
      const res = await fetch('/api/ai-vibe', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ manual, signals })
      });
      if(!res.ok) throw new Error('AI endpoint error');
      return await res.json();
    }catch(e){ return null; }
  }

  async function load(){
    const [manual, rawSignals] = await Promise.all([
      fetchJSON('/status.json'),
      getSignals(),
    ]);
    const ai = await fetchAI(manual, rawSignals);
    const base = ai || mergeSignals(manual, rawSignals);
    setUI(base);
  }

  // Reroll
  document.getElementById('reroll').addEventListener('click', load);

  // Admin local panel
  function initAdmin(){
    const admin = document.getElementById('admin');
    const ta = document.getElementById('adminText');
    const apply = document.getElementById('applyLocal');
    const dl = document.getElementById('downloadJson');

    const show = location.hash === '#admin';
    admin.classList.toggle('visible', show);
    if(!show) return;

    ta.value = JSON.stringify(DEFAULT_STATUS, null, 2);

    apply.addEventListener('click', ()=>{
      try{
        const parsed = JSON.parse(ta.value);
        const merged = mergeSignals(parsed, {});
        setUI(merged);
      }catch(e){ alert('Invalid JSON: ' + e.message); }
    });

    dl.addEventListener('click', ()=>{
      const blob = new Blob([ta.value], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'status.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });
  }

  window.addEventListener('hashchange', initAdmin);

  // Konami code => flips status to NOT OK for fun
  (function(){
    const seq = ["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];
    let i = 0;
    window.addEventListener('keydown', (e)=>{
      if(e.key === seq[i]){ i++; if(i===seq.length){ i=0; setUI({ ok:false, message:"Konami detected. Hunter is not okay (temporarily).", updated_at:new Date().toISOString(), mood_color:'#ff4d6d', metrics:{stability:12, optimism:24, chaos:88, caffeine_cups:5}, chips:["Cheat mode engaged"] }); }} else { i = 0; }
    });
  })();

  initAdmin();
  load();
  </script>
</body>
</html>
